<!DOCTYPE html>
<html>
	<head>
		<title>CrimeMap | CrimeWatch.ph</title>
	</head>
	<body>
		<div id="fb-root"></div>

		<script 
			type="text/javascript" 
			src="@staticServerURL/library/jquery.min.js">
		</script>

		<script 
			type="text/javascript" 
			src="@staticServerURL/library/URI.min.js">
		</script>
		
		<script 
			type="text/javascript" 
			src="http://connect.facebook.net/en_US/sdk.js">
		</script>

		<script 
			type="text/javascript">
			var facebookAppID = "@facebookAppID";

			var uri = URI( );

			//: Do not query anymore if it is already redirected with logged-in parameter.
			if( !uri.hasQuery( "logged-in" ) ){
				var hostAddress = [ 
					"http:/",
					uri.host( ) + uri.path( )
				].join( "/" );

				var redirectToFacebookLogin = function redirectToFacebookLogin( ){
					var redirectURL = [ 
						"https://www.facebook.com/dialog/oauth/?",
						[ 
							[ "client_id" , facebookAppID ].join( "=" ),
							[ "redirect_uri", hostAddress ].join( "=" ),						
							[ "scope", "email" ].join( "=" )
						].join( "&" )
					].join( "" );

					window.location = redirectURL;
				};

				window.fbAsyncInit = function fbAsyncInit( ){
					FB.init( {
						"appId": facebookAppID,
						"status": true,
						"cookie": true,
						"version": "v2.2"
					} );	        

					$( "#fb-root" ).ready( function onReady( ){
						FB.getLoginStatus( function onReponseLoginStatus( response ){
							if( response.error ){
								redirectToFacebookLogin( );

							}else if( response.status === "connected" ){
								window.location = [
									hostAddress,
									[ "logged-in", true ].join( "=" )  
								].join( "?" );

							}else{
								redirectToFacebookLogin( );
							}
						} );
					} );
				};	
			}			
		</script>
	</body>
</html>